<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:TransactionQL.DesktopApp.ViewModels"
             xmlns:dd="using:TransactionQL.DesktopApp"
             xmlns:views="clr-namespace:TransactionQL.DesktopApp.Views"
             mc:Ignorable="d"
             Width="500"
             d:DesignHeight="500"
             x:Class="TransactionQL.DesktopApp.Views.PaymentDetails"
             x:DataType="vm:PaymentDetailsViewModel"
             d:DataContext="{x:Static dd:DesignData.PaymentDetails}">
    <UserControl.Styles>
        <Style Selector="TextBox">
            <Setter Property="BorderBrush" Value="Transparent" />
        </Style>
        <Style Selector="TextBox.h1">
            <Setter Property="FontSize" Value="24" />
            <Setter Property="FontWeight" Value="Bold" />
        </Style>
        <Style Selector="TextBox:focus Border">
            <Setter Property="BorderBrush" Value="Transparent" />
        </Style>

        <Style Selector="TextBlock.h2">
            <Setter Property="FontSize" Value="20" />
            <Setter Property="FontWeight" Value="Regular" />
            <Setter Property="Foreground" Value="Green" />
        </Style>

        <Style Selector="TextBlock.subtitle">
            <Setter Property="Foreground" Value="#888888" />
        </Style>

        <Style Selector="TextBox.p">
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="Margin" Value="0,25,0,0" />
            <Setter Property="LineHeight" Value="25" />
            <Setter Property="BorderBrush" Value="Transparent" />
        </Style>

        <Style Selector="TextBlock.Negative">
            <Setter Property="Foreground" Value="Red" />
        </Style>
    </UserControl.Styles>

    <StackPanel Orientation="Vertical">
        <Border CornerRadius="10" ClipToBounds="True" Margin="0,10,0,10">
            <Border Padding="20" Background="White">
                <RelativePanel Background="White">
                    <TextBox x:Name="Title" Text="{Binding Title}" Classes="h1" Padding="0,6,6,5"
                             RelativePanel.LeftOf="Currency"
                             RelativePanel.AlignLeftWithPanel="True" />

                    <TextBlock Text="{Binding Date, StringFormat='{}{0:yyyy-MM-dd}'}"
                               Classes="subtitle"
                               x:Name="Date" RelativePanel.Below="Title" />
                    <TextBox Text="{Binding Description}"
                             Classes="p"
                             x:Name="Description" RelativePanel.Below="Date"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             RelativePanel.AlignLeftWithPanel="True"
                             RelativePanel.AlignRightWithPanel="True"
                             Padding="0,6,6,5" />
                    <TextBlock x:Name="Currency"
                               Text="{Binding Currency}"
                               Classes="subtitle"
                               RelativePanel.LeftOf="Amount"
                               TextAlignment="Right"
                               Margin="0,0,10,0"
                               MinWidth="50" />
                    <TextBlock Text="{Binding Amount, StringFormat={}{0:.00}}"
                               Classes="h2" Classes.Negative="{Binding IsNegativeAmount}"
                               x:Name="Amount" RelativePanel.AlignRightWithPanel="True" />
                </RelativePanel>
            </Border>
        </Border>
        <Border
            Margin="0,15,0,15"
            CornerRadius="10"
            ClipToBounds="True"
            Background="White">
            <DataGrid
                AutoGenerateColumns="False"
                Items="{Binding Transactions}"
                CanUserReorderColumns="False"
                CanUserSortColumns="False"
                GridLinesVisibility="Horizontal"
                Height="250">

                <DataGrid.Columns>
                    <DataGridTemplateColumn Header="Account"
                                            Width="7*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <!-- Temporarily disable bindings for the AutoCompleteBox, because otherwise Avalonia cannot find 'ValidAccounts' on DataContext
                    As the type is seen as System.Object -->
                                <AutoCompleteBox
                                    x:CompileBindings="False"
                                    BorderBrush="Transparent"
                                    SelectedItem="{Binding Account}"
                                    TextFilter="{Binding AccountAutoCompletePredicate}"
                                    Items="{Binding 
                      Path=DataContext.ValidAccounts,
                      RelativeSource={RelativeSource FindAncestor, AncestorType=views:PaymentDetails}}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="Cur."
                                        Binding="{Binding Currency}"
                                        Width="2*" />
                    <!-- Seems like a lot of trouble to align the Amounts to the right -->
                    <DataGridTemplateColumn Header="Amount"
                                            Width="2*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBox Text="{Binding Amount}"
                                         Margin="0,0,10,0"
                                         VerticalAlignment="Center"
                                         TextAlignment="Right" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>
        <Button Content="Add" Margin="0,0,0,0" Command="{Binding AddTransactionCommand}" />
    </StackPanel>
</UserControl>